(function(){var t;t=this,t.AreaSettings=function(t){return this.district_bounds={},this.layer={},this.init(t)},AreaSettings.prototype.init=function(t){return leaf.districts=t,$(".area_postal_code").click(function(){return $("#postal_code_section").toggle(0,function(){})}),$(".area_postal_code").is(":checked")&&$("#postal_code_section").css("display","block"),$(".area_district").click(function(){return $("#district_section").toggle(0,function(){}),this.drawMapAndDistricts()}),$(".area_district").is(":checked")&&($("#district_section").css("display","block"),this.drawMapAndDistricts()),this.initMapEvents(),this.initDrawingTools()},AreaSettings.prototype.drawMapAndDistricts=function(){var t,e;if(initLeafletMap(map_settings),leaf.drawn_items=L.featureGroup(),leaf.map.addLayer(leaf.drawn_items),leaf.map.addControl(new L.Control.Draw({edit:{featureGroup:leaf.drawn_items}})),null!==leaf.districts){for(t=0,e=[];t<leaf.districts.length;)L.geoJson(leaf.districts[t],{onEachFeature:function(e,i){return i.bindPopup(leaf.districts[t].properties.name),i.setStyle({color:markers.district_color}),leaf.drawn_items.addLayer(i)}}),e.push(t++);return e}},AreaSettings.prototype.initMapEvents=function(){var t;return t=this,$("#map").on("keyup",".save_district_text",function(){return $(".save_district_text").val().length>0?$(".save_district").removeClass("disabled"):$(".save_district").addClass("disabled")}),$("#map").unbind("click"),$("#map").on("click",".save_district",function(){var e;return e=$(".save_district_text").val(),$.post("/user/areasettings/save_district",{bounds:JSON.stringify(t.district_bounds),name:e},function(i){var s;return s="<span class='"+i.style+"'><strong>"+i.message+"</strong></span>",$("#district_notification_message").html(s),"ok"===i.status?(leaf.drawn_items.removeLayer(t.layer),t.district_bounds.properties.id=i.id,t.district_bounds.properties.name=e,L.geoJson(t.district_bounds,{onEachFeature:function(t,s){return s.bindPopup(e),s.setStyle({color:i.district_color}),leaf.drawn_items.addLayer(s)}})):void 0})}),$("#map").on("click",".update_district",function(){var e,i;return i=$(".update_district_text").val(),e=$(".update_district_text").attr("id"),$.post("/user/areasettings/update_district_name",{id:e,name:i},function(t){var e;return e="<span class='"+t.style+"'><strong>"+t.message+"</strong></span>",$("#district_notification_message").html(e)}),leaf.drawn_items.eachLayer(function(s){return t.district_bounds=s.toGeoJSON(),e===t.district_bounds.properties.id?(s.bindPopup("<input type='text' id='"+e+"' class='update_district_text' style='margin-right:5px;' placeholder='District name' value='"+i+"'><button type='button' id='save_"+t.district_bounds.properties.id+"' class='btn btn-xs btn-success update_district'>OK</button><br /><div class='district_notif'></div>"),s.closePopup()):void 0})})},AreaSettings.prototype.initDrawingTools=function(){var t;return t=this,leaf.map.on("draw:created",function(e){var i;return t.layer=e.layer,leaf.drawn_items.addLayer(t.layer),i=L.popup({closeButton:!1}).setContent("<input type='text' class='save_district_text' style='margin-right:5px;' placeholder='District name'><button type='button' class='btn btn-xs btn-success save_district disabled'>Save district</button>"),t.layer.bindPopup(i),t.district_bounds=t.layer.toGeoJSON(),t.layer.openPopup(t.layer.getBounds().getCenter())}),leaf.map.on("draw:editstart",function(e){return leaf.drawn_items.eachLayer(function(e){return t.district_bounds=e.toGeoJSON(),e.bindPopup("<input type='text' id='"+t.district_bounds.properties.id+"' class='update_district_text' style='margin-right:5px;' placeholder='District name' value='"+t.district_bounds.properties.name+"'><button type='button' id='save_"+t.district_bounds.properties.id+"' class='btn btn-xs btn-success update_district'>OK</button><br /><div class='district_notif'></div>")})}),leaf.map.on("draw:editstop",function(e){return leaf.drawn_items.eachLayer(function(e){return t.district_bounds=e.toGeoJSON(),e.bindPopup(t.district_bounds.properties.name)})}),leaf.map.on("draw:edited",function(e){var i,s;return i=e.layers,s=[],i.eachLayer(function(e){return t.district_bounds=e.toGeoJSON(),s.push(t.district_bounds)}),$.post("/user/areasettings/update_districts",{districts:JSON.stringify(s)},function(t){var e;return e="<span class='"+t.style+"'><strong>"+t.message+"</strong></span>",$("#district_notification_message").html(e)})}),leaf.map.on("draw:deleted",function(t){var e,i;return i=t.layers,e=[],i.eachLayer(function(t){var i;return i=t.toGeoJSON(),e.push(i.properties.id)}),$.post("/user/areasettings/delete_districts",{ids:e},function(t){var e;return e="<span class='"+t.style+"'><strong>"+t.message+"</strong></span>",$("#district_notification_message").html(e)})})}}).call(this);