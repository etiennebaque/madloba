<% content_for :head do %>

    <!-- Includes the main Leaflet CSS and JS files, as well as Mapbox files -->
    <%= render 'shared/map_scripts_before_body', include_all_scripts: false %>

    <!-- Specific Leaflet files (plugins) to be loaded for this page -->
    <%= stylesheet_link_tag 'leaflet.awesome-markers' %>
    <%= stylesheet_link_tag 'leaflet-sidebar' %>
    <%= stylesheet_link_tag 'MarkerCluster' %>
    <%= stylesheet_link_tag 'MarkerCluster.Default' %>
    <%= stylesheet_link_tag 'font-awesome.min' %>

    <style type="text/css">
        #map {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100% !important;
            height: 100% !important;
        }
    </style>

<% end %>

<div id="main" class="container-fluid clear-top">
  <div class="row">

    <!-- Leaflet sidebar section, with guided navigation - start -->
    <div id="sidebar" class="semi-transparent hide">
      <!-- Sidebar - 'Create ad' section -->
      <div class="list-group">
        <div class="list-group-item smaller-no-border-no-background">
          <a class="btn btn-success no-color" href="/ads/new"><i class="fa fa-plus"></i> <%= t('home.create_new_ad') %></a>
        </div>
      </div>

      <!-- Sidebar - Refinements section -->
      <% if (@categories && @categories.select{|cat| cat.is_refinement(params)}.length > 0) || @location_search_refinement_to_display || user_search_action %>
          <div class="list-group">
            <h4><%= t('home.refinements') %></h4>

            <% if @categories.select{|cat| cat.is_refinement(params)}.length > 1 %>
                <div id="deleteAllId">
                  <a href="/" class="list-group-item smaller-no-border-no-background">
                    <label style='width: 15px;'>&nbsp;</label>
                    <span class="guided-nav-label"><%= t('home.delete_all') %></span>
                    <i class="glyphicon glyphicon-remove align-cross" style="float: right"></i>
                  </a>
                </div>
            <% end %>

            <% if @location_search_refinement_to_display %>
                <a href = "/" class="list-group-item smaller-no-border-no-background">
                  <span class="guided-nav-label"><%= t('home.your_searched_location') %></span>
                  <i class="glyphicon glyphicon-remove align-cross" style="float: right"></i>
                </a>
            <% end %>
            <% if user_search_action %>
                <a href = "/" class="list-group-item smaller-no-border-no-background">
                  <span class="guided-nav-label"><%= user_search_action %></span>
                  <i class="glyphicon glyphicon-remove align-cross" style="float: right"></i>
                </a>
            <% end %>
            <div id="refinementsId">
              <% @categories.each do |category| %>
                  <% if category.is_refinement(params) %>
                      <a href = "<%= category.refinement_url(params) %>" class="list-group-item smaller-no-border-no-background guided-nav-category">
                        <label style='width: 15px;'>
                          <i class="fa <%= category.icon %>" style="color: <%= category.marker_color_hexacode %>;"></i>
                        </label>
                        <span class="guided-nav-label"><%= category.name %></span>
                        <i class="glyphicon glyphicon-remove align-cross" style="float: right"></i>
                      </a>
                  <% end %>
              <% end %>
            </div>
          </div>
      <% end %>

      <!-- Sidebar - list of Categories -->
      <div class="list-group">
        <% if @categories.length > 0 %>
            <h4><%= t('home.title_guided_nav') %></h4>
            <% @categories.each do |category| %>
                <% if !category.is_refinement(params) %>
                    <a href ="<%= category.refinement_url(params) %>" class="list-group-item smaller-no-border-no-background guided-nav-category">
                      <label style='width: 15px;'>
                        <i class="fa <%= category.icon %>" style="color: <%= category.marker_color_hexacode %>;"></i>
                      </label>
                      <span class="guided-nav-label"><%= category.name %></span>
                    </a>
                <% end %>
            <% end %>

            <% if (@locations_postal && @locations_postal.length > 0) || (@locations_district && @locations_district.length > 0) %>
                <hr />
                <%= image_tag 'madloba_logo.png', width: '26px' %>
                <span class="guided-nav-label"><%= t('home.same_area') %></span>
            <% end %>

        <% else %>
            <div class="list-group">
              <div class="list-group-item smaller-no-border-no-background">
                <p><%= t('home.no_ad') %></p>
                <p><%= t('home.create_an_ad_now_html', createad: (link_to t('home.create_new_ad'), new_ad_url) )%></p>
              </div>
            </div>

        <% end %>
      </div>

      <!-- Sidebar - note with some explanation, for demo only -->
      <% if is_demo %>
          <hr />
          <div class="list-group">
            <i><%= t('home.demo_sidebar_note_html', link: link_to(t('home.admin_panel'), '/user/managerecords#categories')) %></i>
          </div>
      <% end %>

    </div>
    <!-- Leaflet sidebar section, with guided navigation - end -->

    <!-- Map section -->
    <div class="col-xs-12 no-left-right-border">
      <% if @error_location_message %>
          <!-- Alert popup indicating that the searched location was not found, or error occurred while requesting Nominatim data-->
          <div class="alert alert-dismissable alert-danger">
            <button type="button" class="close" data-dismiss="alert">Ã—</button>
            <%= @error_location_message %>
          </div>
      <% end %>

      <div id="home-map-canvas-wrapper">
        <div id="map"></div>
      </div>

    </div>


  </div>

  <!-- Row with 3 columns, above the footer-->
  <div id="upper-footer-id" class="row upper-footer">
    <% if @links.nil? || @links.length == 0 %>
        <!-- If there is no link to display, we span the description section over 2 columns -->
        <div class="col-lg-8">
          <h2><%= t('home.about_website', website: site_name) %></h2>
            <span>
                <% @website_description_paragraph.each do |paragraph| %>
                    <p><%= paragraph %></p>
                <% end %>
              <p><%= link_to "More about #{site_name}...", about_path %></p>
            </span>
        </div>
    <% else %>
        <div class="col-lg-4">
          <h2><%= t('home.about_website', website: site_name) %></h2>
            <span>
                <% @website_description_paragraph.each do |paragraph| %>
                    <p><%= paragraph %></p>
                <% end %>
              <p><%= link_to "More about #{site_name}...", about_path %></p>
            </span>
        </div>
        <div class="col-lg-4">
          <h2><%= t('home.links') %></h2>
            <span>
              <ul>
                <% @links.each do |link| %>
                    <% if link && link[:label] && link[:label] != '' %>
                        <li><a href="<%= link[:url]%>"><%= link[:label] %></a></li>
                    <% end %>
                <% end %>
              </ul>
            </span>
        </div>
    <% end %>
    <div class="col-lg-4">
      <h2><%= t('home.contact_us') %></h2>
        <span>
          <% if @contact_email && @contact_email != '' %>
            <p><%= t('home.send_us_message_html', email: (link_to @contact_email, "mailto:#{@contact_email}") ) %></p>
          <% end %>
          <% if @social_medias.length > 0 %>
            <p>
              <% @social_medias.each do |media| %>
                  <%= link_to image_tag("#{media['name']}.png", size: '40x40'), media['url'], target: '_blank' %>&nbsp;&nbsp;
              <% end %>
            </p>
          <% end %>
        </span>
    </div>
  </div>
</div>

<div id="push"></div>


<!-- Modal popup that shows several ads promoting the same item, in a specific district/area -->
<div class="modal fade" id="adsModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="adsModalTitle"></h4>
      </div>
      <div class="modal-body" id="ads-modal-body-id">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= t('home.close') %></button>
      </div>
    </div>
  </div>
</div>

<!-- This div is to check whether or not the user has AdBlock on in their browser.
If they do, it will affect the website's ability to work well (test carried out in general.js) -->
<div id="ad-block" style="position: absolute; opacity: 1; top: 0; left: 0;">adblock</div>


<!-- Loading JS scripts -->
<% content_for :scripts do %>
    <!-- Includes all the Javascript related to map rendering, to be loaded after page
    (Leaflet, MapQuest, and initialize_map partial that create the actual map)-->
    <%= render 'shared/map_scripts_after_body', include_all_scripts: false %>

    <!-- Leaflet plug-ins and library used on the home page -->
    <%= javascript_include_tag 'leaflet-sidebar', 'leaflet-function-button' %>
    <%= javascript_include_tag 'leaflet.markercluster' %>

    <!-- Javascript function calls, related specifically to the home page -->
    <script>
        // specific script to render map markers and initialize the sidebar.
        var locations_exact = <%= raw @locations_exact.to_json(:include => { :ads => { :include =>  {:items => { :include => :category }}}}) %>;
        var locations_postal = <%= raw @locations_postal.to_json(:include => { :ads => { :include =>  {:items => { :include => :category }}}}) %>;
        var locations_district = <%= raw @locations_district.to_json(:include => { :ads => { :include =>  {:items => { :include => :category }}}}) %>;

        var area_geocodes = <%= raw @area_geocodes.to_json %>;
        var marker_colors = <%= raw MARKER_COLORS.to_json %>;

        putLocationMarkers();

        var category_colors = <%= raw @category_colors.to_json %>;

        initializeSideBar();

    </script>
<% end %>